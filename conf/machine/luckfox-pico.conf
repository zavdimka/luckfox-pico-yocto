# Luckfox Pico RV1106 machine definition
require conf/machine/include/arm/armv7a/tune-cortexa7.inc

SOC_FAMILY = "rockchip"
MACHINEOVERRIDES =. "rockchip:rv1106:"

SERIAL_CONSOLE = "115200 ttyS0"
KERNEL_IMAGETYPE = "Image"
KERNEL_DEVICETREE = "rv1106g-av.dtb"

UBOOT_MACHINE = "luckfox_rv1106_uboot_defconfig"
UBOOT_SUFFIX = "img"
UBOOT_ENTRYPOINT = "0x00200000"

# SDK-style boot medium configuration (matches SDK BoardConfig files)
# Options: sd_card, emmc, spi_nand, spi_nor
RK_BOOT_MEDIUM ?= "emmc"
ROCKCHIP_BOOT_MEDIUM ?= "${RK_BOOT_MEDIUM}"

# Partition layout (SDK-compatible format)
# Format: size@offset(name) where offset is optional (auto-calculated if omitted)
# Size units: K (KB), M (MB), G (GB), - (fill remaining space)
# Example from SDK: "32K(env),512K@32K(idblock),256K(uboot),32M(boot),-(rootfs)"
ROCKCHIP_PARTITION_LAYOUT ?= "32K(env),512K@32K(idblock),256K(uboot),32M(boot),-(rootfs)"

# Fastboot mode (uses _TB variants of INI files)
RK_ENABLE_FASTBOOT ?= "n"

# U-Boot defconfig settings (matching SDK build.sh logic)
RK_UBOOT_DEFCONFIG = "luckfox_rv1106_uboot_defconfig"
RK_UBOOT_DEFCONFIG_FRAGMENT = "${@'rk-sfc.config' if d.getVar('RK_BOOT_MEDIUM') in ['spi_nand', 'spi_nor'] else 'rk-emmc.config'}"

PREFERRED_PROVIDER_virtual/kernel = "linux-luckfox"
PREFERRED_PROVIDER_virtual/bootloader = "u-boot-luckfox"

MACHINE_FEATURES += "wifi bluetooth usbgadget usbhost ext4"

# Keep rootfs/ext4 layout aligned with the legacy SDK
EXTRA_IMAGEDEPENDS += "u-boot-luckfox"
