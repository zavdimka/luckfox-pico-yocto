# Luckfox Pico RV1106 - SPI NAND Configuration
# Inherits from base luckfox-pico machine, changes boot medium to SPI NAND

require conf/machine/luckfox-pico.conf

# Override boot medium for SPI NAND
RK_BOOT_MEDIUM = "spi_nand"
ROCKCHIP_BOOT_MEDIUM = "${RK_BOOT_MEDIUM}"

RK_ENABLE_AB_UPDATE = "0"

# U-Boot SFC (SPI Flash Controller) config fragment for SPI NAND/NOR
RK_UBOOT_DEFCONFIG_FRAGMENT = "rk-sfc.config"

# SPI NAND specific device tree
KERNEL_DTS_FILE = "rv1106g-luckfox-pico-max-t1.dts"

# Partition layout for SPI NAND (UBI volumes)
# Format: size@offset(name:fstype) - offset and fstype are optional, calculated automatically
RK_PARTITION_LAYOUT = "32K(env),256K@256K(idblock),512K(uboot),32M(boot),180M(rootfs:ubifs)"

# SPI NAND Flash parameters (used for UBI/UBIFS calculation)
# Block size: 128K, Page size: 2K
RK_NAND_BLOCK_SIZE = "131072"
RK_NAND_PAGE_SIZE = "2048"

# Boot arguments for UBI/UBIFS
# partition numbers starts from 0
# ubi.mtd=4: attach UBI to MTD partition 4 (rootfs is the 5th partition, index 4)
# root=ubi0:rootfs: mount the "rootfs" UBI volume from ubi0
# rootfstype=ubifs: use UBIFS filesystem for SPI NAND
# rw: mount root filesystem read-write
RK_BOOT_ROOT_ARGS = "ubi.mtd=4 root=ubi0:rootfs rootfstype=ubifs ubi.fm_autoconvert=1"
MACHINE_FEATURES += "ubifs usbhost"
