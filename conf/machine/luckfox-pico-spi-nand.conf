# Luckfox Pico RV1106 - SPI NAND Configuration
# Inherits from base luckfox-pico machine, changes boot medium to SPI NAND

require conf/machine/luckfox-pico.conf

# Override boot medium for SPI NAND
RK_BOOT_MEDIUM = "spi_nand"
ROCKCHIP_BOOT_MEDIUM = "${RK_BOOT_MEDIUM}"

# U-Boot SFC (SPI Flash Controller) config fragment for SPI NAND/NOR
RK_UBOOT_DEFCONFIG_FRAGMENT = "rk-sfc.config"

# SPI NAND specific device tree
KERNEL_DTS_FILE = "rv1106g-luckfox-pico-max-t1.dts"

# Partition layout for SPI NAND (UBI volumes)
# Format: size@offset(name:fstype) - offset and fstype are optional, calculated automatically
RK_PARTITION_LAYOUT = "256K(env),256K@256K(idblock),512K(uboot),32M(boot),-(rootfs:ubifs)"

# UBI/UBIFS parameters for image creation
# Based on RK_NAND_BLOCK_SIZE=128K and RK_NAND_PAGE_SIZE=2K
# LEB size = Block size - 2 * Page size = 128K - 2*2K = 124K = 126976 bytes
# Min I/O size = Page size = 2K = 2048 bytes
# Max LEBs: Set to reasonable size for rootfs (200MB = ~1700 LEBs) to avoid sparse filesystem issues
MKUBIFS_ARGS = "-m 2048 -e 126976 -c 1700 -x lzo"
UBINIZE_ARGS = "-m 2048 -p 131072"
UBI_VOLNAME = "rootfs"

# Boot arguments for UBI/UBIFS
# partition numbers starts from 0
# ubi.mtd=4: attach UBI to MTD partition 4 (rootfs is the 5th partition, index 4)
# root=ubi0:rootfs: mount the "rootfs" UBI volume from ubi0
# rootfstype=ubifs: use UBIFS filesystem for SPI NAND
RK_BOOT_ROOT_ARGS = "ubi.mtd=4 root=ubi0:rootfs rootfstype=ubifs ubi.fm_autoconvert=1"
MACHINE_FEATURES += "ubifs usbhost"
